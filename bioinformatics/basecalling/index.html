
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../data/">
      
      
        <link rel="next" href="../mapping/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.1, mkdocs-material-9.1.21">
    
    
      
        <title>Nanopore sequencing base calling and quality control - Mapping</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nanopore-sequencing-base-calling-and-quality-control" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Mapping" class="md-header__button md-logo" aria-label="Mapping" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mapping
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nanopore sequencing base calling and quality control
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../lab-protocols" class="md-tabs__link">
      Lab-protocols
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../intro-to-linux/" class="md-tabs__link md-tabs__link--active">
        Bioinformatics
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../extra-reading/about_conda/" class="md-tabs__link">
        Extra-reading
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Mapping" class="md-nav__button md-logo" aria-label="Mapping" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Mapping
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../lab-protocols" class="md-nav__link">
        Lab-protocols
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Bioinformatics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Bioinformatics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro-to-linux/" class="md-nav__link">
        Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        The data
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Nanopore sequencing base calling and quality control
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Nanopore sequencing base calling and quality control
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activity-briefing" class="md-nav__link">
    Activity Briefing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basecalling" class="md-nav__link">
    Basecalling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basecalling-quality-control" class="md-nav__link">
    Basecalling - Quality Control
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapter-trimming" class="md-nav__link">
    Adapter Trimming
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kraken-qc" class="md-nav__link">
    Kraken QC
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mapping/" class="md-nav__link">
        Aligning reads
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../variant-calling/" class="md-nav__link">
        Variant calling Oxford Nanopore sequencing data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tb-profiler/" class="md-nav__link">
        TB-profiler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phylogenetics/" class="md-nav__link">
        Phylogenetics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Extra-reading
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Extra-reading
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../extra-reading/about_conda/" class="md-nav__link">
        Conda Environments: Why and How to Use Them
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="nanopore-sequencing-base-calling-and-quality-control">Nanopore sequencing base calling and quality control</h1>
<h2 id="introduction">Introduction</h2>
<p>In this session we are going to be looking at data generated by third-generation nanopore sequencing technology. Developed by Oxford Nanopore Technologies (ONT), these platforms, rather than the next-generation 'sequencing-by-synthesis approach', make use of an array of microscopic protein ‘pores’ set in in an electrically resistant membrane which guide strands of DNA or RNA through them. Each nanopore corresponds to its own electrode connected to a channel and sensor chip, which measures the electric current that flows through the nanopore. When a molecule passes through a nanopore, the current is disrupted to produce a characteristic ‘squiggle’. The squiggle is then decoded using basecalling algorithms to determine the DNA or RNA sequence in real time. Oxford Nanopore’s most popular platform is the MinION which is capable of generating single reads of up to 2.3 Mb (2.3 million bases).</p>
<p><img alt="Nanopore animation" src="../../img/sequencing_animation.gif" />  </p>
<p>The MinION is one of 5 scalable platforms developed by ONT. High-throughput applications such as the GridION and PromethION use an array of nanopore flowcells to produce between 5 to 48 times more data than the MinION alone – outputting up to 48 TB of data in one run. More downscaled solutions such as The Flongle and SmidgION use a smaller, single flowcell to generate data. The MinION is a highly portable sequencing platform, about the size of a large USB flash drive. This technology enables researchers to perform sequencing analyses almost anywhere, providing they have the correct equipment to prepare the DNA libraries and analyse the output data. </p>
<p><img alt="devices" src="../../img/nanopore-devices.jpeg" /> </p>
<p>A complete sequencing run on the MinION platform can generate as much as 1 terabyte of raw data, and downstream analyses require a significant amount of compute power – multicore high performance processors and large amounts of RAM. This poses a significant logistical challenge for researchers who want to take advantage of the platform’s portability aspect. Over recent years, the integration of <a href="https://en.wikipedia.org/wiki/Graphics_processing_unit">GPUs</a> (graphics processing units) in to analysis workflows has sped up applications involving machine learning greatly. </p>
<p><img alt="diagram" src="../../img/pipeline_diagram.png" /> </p>
<h2 id="activity-briefing">Activity Briefing</h2>
<p>Today we will be working with example data, as detailed in the <a href="/bioinformatics/data">data</a> section. Today, we are going to take this raw data and generate some insights to help further understand your MTB samples.  In this session today, we will:</p>
<ul>
<li>Basecall your data, transforming it from squiggle to bases.</li>
<li>Perform quality control on the data, ensuring our data is of sufficient quality for analysis.</li>
<li>Map the reads to a reference genome, producing three genomic </li>
</ul>
<h2 id="basecalling">Basecalling</h2>
<p>To convert the raw data output produced by the MinION sequencing run in to a usable form we need to perform a process called basecalling. This converts the raw electronic signal which is collected as the DNA passes through the pore, in to base reads – A, C, T or G. To do this we will use a program called Guppy – a software package designed by ONT which uses <a href="https://en.wikipedia.org/wiki/Recurrent_neural_network">recurrent neural nets (RNN)</a> to interpret the raw signal, which comes in a proprietary '.fast5' format file produced by the sequencer software and convert it in to the standard .fastq format, for use downstream in our pipeline. Users also have the choice of using the experimental <a href="https://github.com/nanoporetech/dorado">Dorado</a> basecaller which gives the option of training specialised models for specific basecalling applications. As mentioned above, GPUs are used to accelerate the basecalling process. Without a GPU performing basecalling becomes a very slow process, therfore it is advised that users procure a machine with a compatable Nvidia GPU (more information on this here).</p>
<p><img alt="diagram" src="../../img/gpu_diagram.png" /> </p>
<p>Activate the relevant conda environment, navigate to the <code>~/data/example_data/</code> basecalling folder in the home directory, and we’ll start the first step.</p>
<div class="admonition warning">
<p class="admonition-title">Important</p>
<p>Every time you open a new terminal window, you must re-activate the nanopore conda environment.
conda activate nanopore</p>
</div>
<div class="highlight"><pre><span></span><code>conda activate basecalling
</code></pre></div>
<div class="highlight"><pre><span></span><code>cd ~/data/example_data/basecalling/fast5 
</code></pre></div>
<p>Use the <code>ls</code> command to see what is inside this folder. Use <code>head</code> to preview one of the fast5 files. As you might find, it's completely unreadable. This is because at this stage, the data is in a binary format representing the squiggle signal we spoke about previously. We need to basecall this data before we can use it.</p>
<p>Basecalling can be performed in a number of ways. There is an option to perform this while sequencing in the MinKNOW GUI, however this software provides fewer options in the ways basecalling can be completed. Here, we will use Guppy for maximum flexibility. Since the machines we are working on do not have a GPU available we will have to use the two CPU cores available to us. Therefore, we will only basecall a subset (&lt;1%) of the dataset as an example, and in the subsequent steps we will use a pre-basecalled output. Copy the whole line in to the terminal and execute the command:</p>
<div class="highlight"><pre><span></span><code>guppy_basecaller --config ~/bin/ont-guppy-cpu/data/dna_r9.4.1_450bps_fast.cfg --trim_adapters --detect_barcodes --compress_fastq  --input_path ~/data/example_data/basecalling/fast5  --save_path ~/data/example_data/basecalling/fastq
</code></pre></div>
<p>We used the the dna_r9.4.1_450bps_fast model for basecalling as this data was generated with a r9.4.1 chemistry, we also using a model which runs fast but produces lower accuracy data. The model should be adjusted based on the chemistry (e.g. r10.4.1) and the desired speed (fast, higher and superior accuracy). A number of models are listed below.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Model</th>
<th style="text-align: left;">Accuracy</th>
<th style="text-align: left;">Chemistry</th>
<th style="text-align: left;">Flow cell</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">dna_r9.4.1_450bps_fast.cfg</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">Kit 9</td>
<td style="text-align: left;">R9.4.1</td>
</tr>
<tr>
<td style="text-align: left;">dna_r9.4.1_450bps_hac.cfg</td>
<td style="text-align: left;">Med</td>
<td style="text-align: left;">Kit 9</td>
<td style="text-align: left;">R9.4.1</td>
</tr>
<tr>
<td style="text-align: left;">dna_r9.4.1_450bps_sup.cfg</td>
<td style="text-align: left;">High</td>
<td style="text-align: left;">Kit 9</td>
<td style="text-align: left;">R9.4.1</td>
</tr>
<tr>
<td style="text-align: left;">dna_r10.4.1_e8.2_400bps_fast.cfg</td>
<td style="text-align: left;">Low</td>
<td style="text-align: left;">Kit 14</td>
<td style="text-align: left;">R10.4.1</td>
</tr>
<tr>
<td style="text-align: left;">dna_r10.4.1_e8.2_400bps_hac.cfg</td>
<td style="text-align: left;">Med</td>
<td style="text-align: left;">Kit 14</td>
<td style="text-align: left;">R10.4.1</td>
</tr>
<tr>
<td style="text-align: left;">dna_r10.4.1_e8.2_400bps_sup.cfg</td>
<td style="text-align: left;">HIgh</td>
<td style="text-align: left;">Kit 14</td>
<td style="text-align: left;">R10.4.1</td>
</tr>
</tbody>
</table>
<p>You should now see the bascalling process begin, and a progress bar appear. This may take some time depending on the performance of your machine.</p>
<p>When the process in completed, you will find the basecalled reads in a .fastq formatted file. Navigate there by typing the following in to the terminal:  </p>
<div class="highlight"><pre><span></span><code>cd ~/data/example_data/basecalling/fastq/pass
</code></pre></div>
<p>Use the <code>ls</code> command to see what is inside this folder. This directory holds several folders - one for each barcode found by guppy. Each of these folders contains the fastq formatted 'pass' reads from the basecalling process. The reads have a quality score &gt; 7. Use  <code>zcat FILENAME | head</code> (remebering to use the correct filename) to preview the compresssed fastq file. Unlike the fast5 files, these are human-readable and contain all of the read data required for downstream analyses. Can you identify any of the common elements of a <strong>.fastq</strong> format files - similar to the ones you may have encountered in previous sessions? Click here to find out more about the <a href="https://en.wikipedia.org/wiki/FASTQ_format">FASTQ</a> format.</p>
<h2 id="basecalling-quality-control">Basecalling - Quality Control</h2>
<p>Before moving on to the analysis steps, it is important to gauge the quality of your sequencing output. There are numerous factors which dictate the quality of the output data, spanning between quality of the input material, library preparation to software and hardware failure. We will look at some important metrics produced by the sequencer which will give us a feel for how well the run went.
In order to get the run metrics in to a useful form, we will use an pycoQC to produce a range of plots in a HTML output, which we will use to judge the quality of the sequencing run. Something to note, is that in this activity we will only use a small subset of the sequenced reads, or else the analysis would take all day. This subsetting means that the sequencing telemetry may look inconsistent, when compared to a full run.</p>
<div class="highlight"><pre><span></span><code>pycoQC -f ~/data/example_data/basecalling/fastq/.sequencing_summary.txt -o ~/data/example_data/basecalling/fastq/pycoqc_results.html
</code></pre></div>
<p>After executing the command you should find a file called 'pycoqc_results.html'. Open them up in the file manager or in the terminal (with the below command) and inspect some of the plots and see what you can find out. As mentioned, the data here are only a small subset of reads, so some of the plots are incomplete. But this should give you a good idea of how this analysis should look.</p>
<div class="highlight"><pre><span></span><code>firefox ~/data/example_data/basecalling/fastq/pycoqc_results.html
</code></pre></div>
<p>Before continuing, quit firefox by clicking the X in the top right corner of the web-browser window.</p>
<div class="admonition question">
<p class="admonition-title">Exercise 1</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Question 1</label><label for="__tabbed_1_2">Answer 1</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Approximately how long did the sequencing run take?</p>
</div>
<div class="tabbed-block">
<p>You can find the answer in the 'General run summary' table.</p>
<p>48.06 hours</p>
</div>
</div>
</div>
</div>
<div class="admonition question">
<p class="admonition-title">Exercise 2</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Question 2</label><label for="__tabbed_2_2">Answer 2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>What is the N50 of the <em>passed</em> reads (&gt;Q7) for all basecalled reads in this run?</p>
</div>
<div class="tabbed-block">
<p>Try looking at the table at the top of the pycoQC report. Be sure to find the 'Passed' read section.</p>
<p>1990</p>
</div>
</div>
</div>
</div>
<h2 id="adapter-trimming">Adapter Trimming</h2>
<p>Nanopore library preparation results in the addition of a sequencing adapter at each end of the fragment. Both the template and complement strands to be sequenced carry the motor protein which means both strands are able to translocate the nanopore. For downstream analysis, it is important to remove these adapters. For this we will use Porechop. This program processes all of the reads in our basecalled fastq file, and removes these adapter sequences. Furthermore, the ligation library prep process can result in conjoined reads, meaning an adapter will be found in the middle of an extra-long read. Porechop will identify these, split them and remove the adapters. In addition, if you use a multiplexing kit to maximise sample throughput, this program will split the reads based on the molecular barcode added to each sample. Our dataset only has one sample, so this demultiplexing won't be necessary. </p>
<p>Let's launch porechop and remove the adapters from the basecalled fastq file of barcode01.</p>
<div class="highlight"><pre><span></span><code>cd ~/data/example_data/basecalling/fastq

porechop -i ~/data/example_data/basecalling/fastq/pass/barcode01 -o barcode01.porechop.fastq
</code></pre></div>
<p>Read the output of the terminal to understand better what porechop is doing to the dataset. Ask a demonstrator if you have any questions about this.</p>
<h2 id="kraken-qc">Kraken QC</h2>
<p>Another method of quality control is to check our reads for sequence contamination from other 'off-target' organisms. This is important in order to firstly, understand how effective your DNA extraction, enrichment and sequencing was. And secondly, to prevent anomalous reads from being incorporated in to assemblies.
Using our basecalled reads we will perform an analysis using Kraken. Kraken is a tool which sifts through each read in a .fastq file and crosschecks it against a database of microorganism genomes. The output is a taxonomic assignment of each read, enabling to identify if any contamination has occurred. In this case we will be looking for any reads which do not belong to the Plasmodium knowlesi genome.
Let’s navigate to the kraken folder to begin the analysis:</p>
<div class="highlight"><pre><span></span><code>cd ~/data/example_data/kraken
</code></pre></div>
<p>The following line of code is composed of these elements:</p>
<ul>
<li><code>kraken2</code> – calling the kraken2 executable</li>
<li><code>--db ~/tb-kraken</code> - this points kraken to a vast sequence database of relevant microorganisms to cross-check our reads against</li>
<li><code>--output sample1.koutput.txt</code> – this argument locates the output file</li>
<li><code>~/data/example_data/sample1.fastq.gz</code> – this argument locates the input file</li>
</ul>
<p>As before, to save time, we will run Kraken on only one sample. Type the following command in to the terminal to unleash the Kraken:</p>
<div class="highlight"><pre><span></span><code>kraken2 --db ~/tb-kraken --output sample1.koutput.txt ~/data/example_data/sample1.fastq.gz
</code></pre></div>
<p>This file isn't particularly easy to interpret, so we will use a program called Recentrifuge to transform these data in to a more human-readable format.</p>
<div class="highlight"><pre><span></span><code>rcf -k sample1.koutput.txt -o sample1.rcf.html --nodespath ./taxdump
</code></pre></div>
<p>Try opening the HTML file generated by recentrifuge in a web browser, what can you tell about the sequencing run? Was is successful? Note - due to constraints with the virtual machine, we have generated an alternative report, which can be loaded using the below command. Copy and paste it in to the terminal. If you have any questions about this, ask a demonstrator.</p>
<div class="highlight"><pre><span></span><code>firefox sample1.rcf.html
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Exercise 3</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Question 3</label><label for="__tabbed_3_2">Answer 3</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Run this analysis for sample 2. Can you see any contaminating reads? What organism(s) is/are there?</p>
</div>
<div class="tabbed-block">
<p>Looks like we have a mixture of <em>M. intracellulare</em> and <em>M. tuberculosis</em>. Why do you think this might be?</p>
</div>
</div>
</div>
</div>
<div class="admonition info">
<p class="admonition-title">Cheat sheet</p>
<div class="highlight"><pre><span></span><code>conda activate basecalling
cd ~/data/example_data/basecalling/fast5 
guppy_basecaller --config ~/bin/ont-guppy-cpu/data/dna_r9.4.1_450bps_fast.cfg --trim_adapters --detect_barcodes --compress_fastq  --input_path ~/data/example_data/basecalling/fast5  --save_path ~/data/example_data/basecalling/fastq
cd ~/data/example_data/basecalling/fastq/pass
pycoQC -f ~/data/example_data/basecalling/fastq/.sequencing_summary.txt -o ~/data/example_data/basecalling/fastq/pycoqc_results.html
firefox ~/data/example_data/basecalling/fastq/pycoqc_results.html &amp;
cd ~/data/example_data/basecalling/fastq
porechop -i ~/data/example_data/basecalling/fastq/pass/barcode01 -o barcode01.porechop.fastq
cd ~/data/example_data/kraken
kraken2 --db ~/tb-kraken --output sample1.koutput.txt ~/data/example_data/sample1.fastq.gz
rcf -k sample1.koutput.txt -o sample1.rcf.html --nodespath ./taxdump
firefox sample1.rcf.html &amp;
kraken2 --db ~/tb-kraken --output sample2.koutput.txt ~/data/example_data/sample2.fastq.gz
rcf -k sample2.koutput.txt -o sample2.rcf.html --nodespath ./taxdump
firefox sample2.rcf.html &amp;
</code></pre></div>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tooltips", "navigation.instant", "navigation.tabs", "toc.integrate", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>