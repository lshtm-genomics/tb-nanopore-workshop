
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../basecalling/">
      
      
        <link rel="next" href="../variant-calling/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.1, mkdocs-material-9.1.21">
    
    
      
        <title>Aligning reads - Mapping</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aligning-reads" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Mapping" class="md-header__button md-logo" aria-label="Mapping" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mapping
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Aligning reads
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../lab-protocols" class="md-tabs__link">
      Lab-protocols
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../intro-to-linux/" class="md-tabs__link md-tabs__link--active">
        Bioinformatics
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../extra-reading/about_conda/" class="md-tabs__link">
        Extra-reading
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Mapping" class="md-nav__button md-logo" aria-label="Mapping" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Mapping
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../lab-protocols" class="md-nav__link">
        Lab-protocols
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Bioinformatics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Bioinformatics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro-to-linux/" class="md-nav__link">
        Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        The data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basecalling/" class="md-nav__link">
        Nanopore sequencing base calling and quality control
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Aligning reads
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Aligning reads
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intended-learning-outcomes" class="md-nav__link">
    Intended learning outcomes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#software" class="md-nav__link">
    Software
  </a>
  
    <nav class="md-nav" aria-label="Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minimap2" class="md-nav__link">
    Minimap2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#samtools" class="md-nav__link">
    Samtools
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-mapping" class="md-nav__link">
    Running mapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indexing" class="md-nav__link">
    Indexing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-control" class="md-nav__link">
    Quality control
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viewing-the-alignments" class="md-nav__link">
    Viewing the alignments
  </a>
  
    <nav class="md-nav" aria-label="Viewing the alignments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loading-your-bam-file" class="md-nav__link">
    Loading your bam file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identifying-mutations" class="md-nav__link">
    Identifying mutations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../variant-calling/" class="md-nav__link">
        Variant calling Oxford Nanopore sequencing data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tb-profiler/" class="md-nav__link">
        TB-profiler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phylogenetics/" class="md-nav__link">
        Phylogenetics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Extra-reading
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Extra-reading
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../extra-reading/about_conda/" class="md-nav__link">
        Conda Environments: Why and How to Use Them
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="aligning-reads">Aligning reads</h1>
<h2 id="intended-learning-outcomes">Intended learning outcomes</h2>
<p>This practical session goes into how to align long-read sequencing data from ONT to a reference genome:</p>
<ol>
<li>Define the process of mapping sequence data</li>
<li>Describe the different softwares used in the process</li>
<li>Apply the commands to new data</li>
</ol>
<h2 id="background">Background</h2>
<p>Aligning short reads from next-generation sequencing platforms such as Oxford Nanopore Technology (ONT) to a reference genome is an essential step in the data analysis pipeline for several compelling reasons. Firstly, ONT generates millions of reads, typically around a couple of kb in length, making them challenging to interpret individually. By aligning these reads to a reference genome, we can accurately map each read's origin and reconstruct the underlying genomic sequence. This process enables the detection of genetic variations, such as single-nucleotide polymorphisms (SNPs) and structural variants, aiding in the understanding of genetic diversity and finding important mutations such as those that casue resistance.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Usually we refer to the alignment of reads to a reference as <strong>mapping</strong>. You might see these used interchangebly in the literature and in protocols.</p>
</div>
<p>To perform mapping of the reads we need to use a reference genome. Mycobacterium tuberculosis (Mtb) does not have a large amount of genomic diversity compared to other bacteria and for most purposes we can use the sequence of the H37Rv lab strain which was published in 1998 by Cole et al<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>. We have downloaded the reference sequence for you and have put it in the <code>~/refgenome/</code> directory under the name <code>tb.fasta</code>.</p>
<p>The FASTA format is a widely used text-based file format for representing biological sequence data. It is named after the program FASTA, which introduced this format for sequence similarity searching. In a FASTA file, each biological sequence (DNA, RNA, or protein) is represented by two parts: a single-line sequence identifier, beginning with the "&gt;" symbol, followed by a multi-line sequence data section. The sequence data contains the actual string of letters representing the sequence itself. FASTA format is simple, human-readable, and allows for easy exchange of biological sequence data among researchers and bioinformatics tools. Its versatility and popularity make it an essential standard for storing and sharing genetic and protein sequence information in various bioinformatics applications and databases.</p>
<div class="admonition question">
<p class="admonition-title">Exercise</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Question</label><label for="__tabbed_1_2">Answer</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Try to use the skills you learned in the into to linux session to take a look at the <abbr title="A format used to store sequence data">fasta</abbr> file and check it matches the description above.</p>
</div>
<div class="tabbed-block">
<p>You can use the <code>head</code> command to look at the file
<div class="highlight"><pre><span></span><code>head ~/refgenome/tb.fasta
</code></pre></div></p>
</div>
</div>
</div>
</div>
<p>Let's find out some more about the TB sequence. We can use a tool called <code>seqkit</code> for this, this will give you basic information such as the length of sequence and the number of sequences.</p>
<div class="highlight"><pre><span></span><code>seqkit stats ~/refgenome/tb.fasta
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Exercise</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Question</label><label for="__tabbed_2_2">Answer</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>What is the length of the genome sequence?</p>
</div>
<div class="tabbed-block">
<p>You should be able to see that the "sum_len" column reports 4,411,532 which is the number of basepairs in the genome of Mtb.</p>
</div>
</div>
</div>
</div>
<p>The sum_len, min_len, avg_len and max_len columns all report the same value because there is only one sequence in the tb genome. These columns are more useful to look at when analysing files with multiple sequences, for example, the fastq files we get from the minION.</p>
<p>The basecalled data is in the <code>~/data/example_data</code> folder. Change the working directory to where the data is using the the following command:</p>
<div class="highlight"><pre><span></span><code>cd ~/data/example_data
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Exercise</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Question</label><label for="__tabbed_3_2">Answer</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>What is the mean length of the reads for the different samples?
Which sample has the most reads?</p>
</div>
<div class="tabbed-block">
<p>You can use seqkit to find this by running:</p>
<div class="highlight"><pre><span></span><code>seqkit stats *.fastq.gz
</code></pre></div>
<p>This will give you the stats for all four files. Sample1 has the most reads with 278,337 reads.</p>
</div>
</div>
</div>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The asterisk ("*") represents zero or more characters. When used in commands, it matches any sequence of characters. In the example above it matchs all files with a ".fastq.gz" extension, regardless of the filename's prefix or length. You can try this out by running the following command:</p>
<div class="highlight"><pre><span></span><code>echo *.fastq.gz
</code></pre></div>
</div>
<h2 id="software">Software</h2>
<p>First things first let's activate the right environment</p>
<div class="highlight"><pre><span></span><code>conda activate mapping
</code></pre></div>
<h3 id="minimap2">Minimap2</h3>
<p>We are now going to align our reads to the H37Rv reference using a tool called <code>minimap2</code>, which is a versatile and efficient sequence alignment tool primarily used for mapping DNA or RNA sequences against reference genomes. It is designed to handle long-read sequencing data, which is generated by technologies like PacBio or Oxford Nanopore. To perform its alignment tasks, Minimap2 requires the following inputs:</p>
<ol>
<li>
<p>Query Sequences: These are the sequences that you want to align to the reference genome. Query sequences can be in FASTA or FASTQ format and typically represent DNA or RNA sequences generated from sequencing technologies like PacBio or Oxford Nanopore.</p>
</li>
<li>
<p>Reference Genome: Minimap2 needs a reference genome against which the query sequences will be aligned. The reference genome is typically a well-assembled, known genome, represented in a FASTA format. It acts as a blueprint to which the query sequences are compared and aligned. It also takes in some optional parameters such as the type of input data (e.g. ONT or PacBio). </p>
</li>
</ol>
<h3 id="samtools">Samtools</h3>
<p>We will also utilise <code>samtools</code> to store the aligned data in an appropriate format. Samtools is a widely used and powerful software suite for processing and manipulating data from high-throughput DNA sequencing experiments. Its name is derived from the "Sequence Alignment/Map" format, commonly known as SAM. Samtools allows researchers to work with sequence data in SAM, BAM (binary version of SAM), and CRAM (compressed version of SAM) formats. Key functionalities of <code>samtools</code> include file format conversion, sorting and indexing. </p>
<p>Samtools is an essential component in many bioinformatics pipelines and is widely adopted by researchers and bioinformaticians to process, analyze, and interpret next-generation sequencing data. Its efficiency, versatility, and open-source nature have contributed to its popularity in the genomics community. </p>
<h2 id="running-mapping">Running mapping</h2>
<p>To run the mapping analysis for sample1 please run the following command:</p>
<div class="highlight"><pre><span></span><code>minimap2 -a -x map-ont ~/refgenome/tb.fasta sample1.fastq.gz | samtools sort - -o sample1.bam
</code></pre></div>
<p>There are a few things going with this command so lets go through each component. First of all you'll probably notice that there is a pipe (|) present so this means that there are two jobs running in series. The first one if <code>minimap2</code> which passes its processed data to <code>samtools</code>. We'll go through the <code>minimap2</code> part first. </p>
<p>The <code>-a</code> argument tells minimap to output in SAM format. The <code>-x map-ont</code> argument tells the software that we are mapping ONT data and as such the process will be optimised for this. </p>
<p>The SAM format data is then passed to samtools using a pipe. We use the <code>samtools sort</code> function to sort the data and store it in a binary compressed version of SAM called BAM format. Samtools can either read from an existing file or read from a pipe and this is given using the first command. We used the <code>-</code> character to tell samtools that we are reading from a pipe. The <code>-o sample1.bam</code> argument tells samtools to store the output in a file called <strong>sample1.bam</strong>. </p>
<h2 id="indexing">Indexing</h2>
<p>BAM files are binary representations of aligned sequencing data, and indexing these files enhances data accessibility and dramatically speeds up specific operations. Indexing allows software to quickly retrieve data from specific genomic regions, making it essential for tasks such as variant calling, visualization, and downstream analyses. Without an index, tools would need to scan the entire BAM file sequentially, resulting in significantly slower processing times, especially for large datasets. Additionally, indexed BAM files are required for many bioinformatics tools to function correctly, ensuring proper data manipulation, extraction, and filtering. We can index the bam file using samtools:</p>
<div class="highlight"><pre><span></span><code>samtools index sample1.bam
</code></pre></div>
<h2 id="quality-control">Quality control</h2>
<p>As usual we need to check the quality of the alignments. There are a few quick metrics that we can check to see if the process has worked correctly. These include:</p>
<ol>
<li>The total number of reads mapped</li>
<li>The percentage of total reads that mapped to the reference</li>
<li>The average depth of coverage across the genome</li>
<li>The percentage of the genome that is covered by our minimum desired depth</li>
</ol>
<p>For all these metrics, higher values are better and indicate better coverage across the genome. We can use <code>samtools</code> to do the calculations. The first two can be computed using the following command:</p>
<div class="highlight"><pre><span></span><code>samtools flagstat sample1.bam
</code></pre></div>
<p>This will print out a few different numbers two of which include the total number of reads mapped and the percentage of reads that mapped. </p>
<p>Metrics 3 and 4 can be calculated by first using bedtools to calculate the depth of coverage across every site in the genome. We can do this with the following command:</p>
<div class="highlight"><pre><span></span><code>bedtools genomecov -ibam sample1.bam &gt; sample1.cov.txt
</code></pre></div>
<p>Have a look at the file by using <code>less</code> or <code>head</code>. The columns show:</p>
<ol>
<li>Chromosome name</li>
<li>Depth</li>
<li>Number of bases at that depth</li>
<li>Total length of the genome</li>
<li>Fraction of the genome at that depth</li>
</ol>
<p>A good coverage for downstream analysis would be &gt;=20x. We can work this out manually usuing the coverage file or we can do it automatically with a script that we have written for you:</p>
<div class="highlight"><pre><span></span><code>genomecov_summary.py -i sample1.cov.txt -c 20
</code></pre></div>
<p>This will print the percentage of the genome that is covered by 20x. You can change the <code>-c</code> number if you need to be more or less stringent.</p>
<div class="admonition question">
<p class="admonition-title">Exercise</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Question</label><label for="__tabbed_4_2">Answer</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Try run this for the other sample bams. Do they all have sufficient coverage?</p>
</div>
<div class="tabbed-block">
<p>Sample 2 has very low coverage and is not sufficient for downstream analysis.</p>
</div>
</div>
</div>
</div>
<h2 id="viewing-the-alignments">Viewing the alignments</h2>
<p>Another way to look at the quality of your alignments is by using a genome browser. The Integrative Genomics Viewer (IGV) is a powerful and widely used genome browser that facilitates the visualization and analysis of genomic data. Developed by the Broad Institute, IGV provides researchers with a user-friendly interface to explore various genomic data types, including next-generation sequencing data. Users can view aligned sequence reads, gene annotations, and genomic features, as well as compare multiple samples and datasets simultaneously. Open up the GUI by entering <code>igv</code> in to the terminal. You should see a window pop up pre-loaded with the Mtb genome. </p>
<h3 id="loading-your-bam-file">Loading your bam file</h3>
<p>Load your bam files by clicking on "File" -&gt; "Load from File..." and then selecting the bam files for sample 1 and sample 2 that you created earlier.</p>
<div class="admonition warning">
<p class="admonition-title">Important</p>
<p>IGV requires an index file for all the bam files you are loading. If you get an error please check if you have run this step.</p>
</div>
<p>There is a lot going on on the screen so have a look at the image below which explains some of the most important features.</p>
<p><img alt="" src="../../img/mapping_1.jpg" /></p>
<ol>
<li>Zoom controls: This controls the level of zoom. To see your alignments you will need to zoom in</li>
<li>Search bar: Here you can specify the region you want to view using genomic coordinates in the form of Chromosome:start-end. You can also search by gene name.</li>
<li>Coverage track: This displays when you have loaded a bam file and is a bargraph where each bar represents a genomic position and the high is determined by the number of reads aligning to that position. If you click on a bar it will open up a window telling you the number of ACTGs. </li>
<li>Alignment track: Each grey bar represents a read. If there are coloured nucleotides, black dashes or purple vertical lines it represents a difference from the reference. Have a look at <a href="https://software.broadinstitute.org/software/igv/AlignmentData">this document</a> to find out more.</li>
<li>Gene track: This shows the location and orientation of the genes. Click on a gene to find out more information.</li>
</ol>
<div class="admonition question">
<p class="admonition-title">Exercise</p>
<p>Have a go at exploring your alignments. What differences do you see between the two samples you have loaded?</p>
</div>
<h3 id="identifying-mutations">Identifying mutations</h3>
<p>You might have noticed a lot of colour on both the the coverage track and the alignment track. This indicates that the aligned data differs from the reference and this could arise from a mutation. It is important to distinguish between a true mutation and an error from the sequencer. A high depth of sequencing is essential in next-generation sequencing (NGS) data analysis to accurately identify true mutations amid the inherent noise and errors in the sequencing process. </p>
<p>The depth of sequencing refers to the number of times a given base in the genome is sequenced or covered by reads. By increasing the depth of sequencing, we improve the confidence in the called variants and enhance the ability to distinguish true mutations from sequencing artifacts or random errors. In regions with low coverage, the probability of missing genuine mutations increases, leading to false-negative results.  Therefore, a high depth of sequencing is crucial in NGS data analysis to ensure the reliability and accuracy of identified mutations and to gain deeper insights into the underlying genomic variations. As ONT data is relatively noisy compared to Illumina data, it is important to get a good coverage across your samples.</p>
<p>Let's zoom into a region containing the rpoB gene. This gene is the target of rifampicin and mutation confering resistance often arise in thes gene. Type in "rpoB" into the search bar and hit enter to zoom into the correct region. You should see a view similar to the one below.</p>
<p><img alt="" src="../../img/mapping_2.png" /></p>
<p>Colours are displayed on the coverage track if a non-reference nucleotide is present at &gt;= 20% of the total reads aligning to that position. These are potential candidates for containing a mutation. </p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>What differences do you notice between the two samples? What does this mean?</p>
</div>
<p>Zoom into a few of the potential variant positions in sample1 as shown in the figure below. Can you identify which ones are error and which are true variants? </p>
<p><img alt="" src="../../img/mapping_3.png" /></p>
<p>A simple method would be to use a majority consensus rule, whereby you take look at the allele which constitutes &gt;=50% of the total reads and check if it is different from the reference. Fill in the table below to see if you have any mutations. You can zoom to a specific potition my inputting the locus into the search bar (e.g. "Chromosome:760497") and hitting enter.</p>
<table>
<thead>
<tr>
<th>Position</th>
<th>Reference</th>
<th>Majority allele</th>
<th>Variant</th>
</tr>
</thead>
<tbody>
<tr>
<td>760497</td>
<td>C</td>
<td>C</td>
<td>No</td>
</tr>
<tr>
<td>761155</td>
<td>C</td>
<td><input type="text"></input></td>
<td><input type="text"></input></td>
</tr>
<tr>
<td>761422</td>
<td>A</td>
<td><input type="text"></input></td>
<td><input type="text"></input></td>
</tr>
<tr>
<td>761423</td>
<td>T</td>
<td><input type="text"></input></td>
<td><input type="text"></input></td>
</tr>
<tr>
<td>761656</td>
<td>C</td>
<td><input type="text"></input></td>
<td><input type="text"></input></td>
</tr>
</tbody>
</table>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>It looks like sample2 has many more variants. Are these true variants or errors?</p>
</div>
<p>While it is very useful to look at the sequencing data as we have above, however it is very time consuming as I'm sure you have noticed. While it is possible to do for a specific gene in a sample, this method is not feasible if we scale up to the 4000 genes and multiple samples. For this reason we have automated methods that do exactly as we have done. We will cover these methods in variant detection.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Cole, S. T. et al. Deciphering the biology of Mycobacterium tuberculosis from the complete genome sequence. Nature 393, 537–544 (1998).&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.tooltips", "navigation.instant", "navigation.tabs", "toc.integrate", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>